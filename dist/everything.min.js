"use strict";angular.module("myApp",["ngTouch","ui.bootstrap"]).factory("gameLogic",function(){function a(){return[["","","","","","","",""],["","","","","","","",""],["","","","","","","",""]]}function b(){return{count:0,phase:1,phaseLastTime:1,alreadyMills:[]}}function c(){var a=[];return a[0]=b(),a[1]=b(),a}function d(a,b){for(var c=0;c<b.length;c++)if(a.sort().toString()===b[c].sort().toString())return!0;return!1}function e(a,b,c){var e,f,g={};for(f=1;7>=f;f+=2)if(a[0][f]===c&&a[1][f]===c&&a[2][f]===c&&!d([[0,f],[1,f],[2,f]],b))return g.player=c,g.mills=[[0,f],[1,f],[2,f]],g;for(e=0;2>=e;e++)for(f=0;6>=f;f+=2)if(a[e][f]===c&&a[e][f+1]===c&&a[e][(f+2)%8]===c&&!d([[e,f],[e,f+1],[e,(f+2)%8]],b))return g.player=c,g.mills=[[e,f],[e,f+1],[e,(f+2)%8]],g;return g.player="N",g.mills=[],g}function f(a,b){var c=a,d=b;if(c[0]===d[0]){if(1===Math.abs(c[1]-d[1])||7===Math.abs(c[1]-d[1]))return!0}else if(c[1]===d[1]&&c[1]%2===1&&1===Math.abs(c[0]-d[0]))return!0;return!1}function g(a,b){var c,d,e=0;for(c=0;2>=c;c++)for(d=0;7>=d;d++)0===b&&"W"===a[c][d]&&e++,1===b&&"B"===a[c][d]&&e++;return e}function h(a,b){var c,d,e=[],g=1;for(c=0;2>=c;c++)for(d=0;7>=d;d++)""===a[c][d]&&f([c,d],b)&&(g=0,e.push([c,d]));return 1===g?"N":e}function i(a,b){var c,d,e=0===b?"W":"B";for(c=0;2>=c;c++)for(d=0;7>=d;d++)if(a[c][d]===e&&"N"!==h(a,[c,d]))return!0;return!1}function j(a,b){var c=b[0].phase,d=b[1].phase;return 1!==c&&g(a,0)<3?"B":1!==d&&g(a,1)<3?"W":2!==c||i(a,0)?2!==d||i(a,1)?"N":"W":"B"}function k(a,b,c){var d=b[c].phase,f=g(a,c),h=0===c?"W":"B",i=e(a,b[c].alreadyMills,h);return i.player===h?4:d=9===b[c].count?2:3===f&&2===b[c].phaseLastTime?3:4===d?b[c].phaseLastTime:d}function l(a,b,c){for(var d=0===b?"W":"B",e=0;e<c.length;e++)if(a[c[e][0]][c[e][1]]!==d)return!1;return!0}function m(a,b,c){for(var d=0;d<b[c].alreadyMills.length;d++)if(!l(a,c,b[c].alreadyMills[d]))return d;return-1}function n(a,b,c){var d=0===c?"W":"B",f=b[c].phase,h=e(a,b[c].alreadyMills,d),i=angular.copy(b[c].alreadyMills),j=angular.copy(b[1-c].alreadyMills),l=m(a,b,c),n=m(a,b,1-c),o=angular.copy(b);4!==f&&(o[c].count=o[c].count+1);var p=k(a,o,c),q=g(a,1-c);return-1!==l&&i.splice(l,1),-1!==n&&j.splice(n,1),h.player===d&&i.push(h.mills),3===q&&2===b[1-c].phaseLastTime&&(o[1-c].phase=3,o[1-c].phaseLastTime=2),o[c].phase=p,o[c].phaseLastTime=f,o[c].alreadyMills=i,o[1-c].alreadyMills=j,o}function o(b,d,g,h,i,k,l){void 0===b&&(b=a()),void 0===d&&(d=c());var m,o,p=0===l?"W":"B",q=d[l].phase,r=j(b,d),s=angular.copy(b);if("N"!==r)throw new Error("Can only make a move if the game is not over!");if(4!==q&&""!==b[g][h])throw new Error("That place has been occupied!");if(1===d[l].phase)s[g][h]=p;else if(2===d[l].phase||3===d[l].phase){if(!f([g,h],[i,k])&&2===d[l].phase)throw new Error("You can only move to an adjacent place!");if(b[i][k]!==p)throw new Error("You can only move the your man!");s[g][h]=p,s[i][k]="",r=j(s,d),"N"!==r&&(m={endMatch:{endMatchScores:"B"===r?[0,1]:[1,0]}})}else if(4===d[l].phase){var t="B"===p?"W":"B";if(b[i][k]!==t)throw new Error("Please choose a man of the enemy to remove!");s[i][k]="",r=j(s,d),"N"!==r&&(m={endMatch:{endMatchScores:"B"===r?[0,1]:[1,0]}})}return"N"===r&&(m=e(s,d[l].alreadyMills,p).player===p?{setTurn:{turnIndex:l}}:{setTurn:{turnIndex:1-l}}),o=n(s,d,l),[m,{set:{key:"board",value:s}},{set:{key:"playerStates",value:o}},{set:{key:"delta",value:{destination:[g,h],origin:[i,k]}}}]}function p(a,b,c){var d,e,f,g,h=[],i=b[c].phase;if(1===i||4===i)for(d=0;2>=d;d++)for(e=0;7>=e;e++)try{h.push(1===i?o(a,b,d,e,null,null,c):o(a,b,null,null,d,e,c))}catch(j){}if(2===i||3===i)for(d=0;2>=d;d++)for(e=0;7>=e;e++)for(f=0;2>=f;f++)for(g=0;7>=g;g++)try{h.push(o(a,b,d,e,f,g,c))}catch(j){}return h}function q(a){var b=a.move,c=a.turnIndexBeforeMove,d=a.stateBeforeMove;try{var e=b[3].set.value,f=e.destination[0],g=e.destination[1],h=e.origin[0],i=e.origin[1],j=d.board,k=d.playerStates,l=o(j,k,f,g,h,i,c);if(!angular.equals(b,l))return!1}catch(m){return!1}return!0}return{getInitialBoard:a,getInitialStates:c,getAllPossibleMove:p,createMove:o,isMoveOk:q}}),angular.module("myApp").controller("Ctrl",["$scope","$log","$timeout","$rootScope","$translate","gameService","stateService","gameLogic","aiService","resizeGameAreaService","dragAndDropService",function(a,b,c,d,e,f,g,h,i,j,k){function l(c,e,g){if(void 0!==a.playerStates&&-1!==a.turnIndex){var i=a.playerStates[a.turnIndex].phase,j=e-x.offsetLeft,k=g-x.offsetTop;if(0>j||0>k||j>=x.clientWidth||k>=x.clientHeight){if(!C)return;var l=o();n({top:k-l.height/2,left:j-l.width/2})}else{F=Math.floor(z*j/x.clientWidth),E=Math.floor(y*k/x.clientHeight);var p,r;if(0===F&&0===E?(p=0,r=0):3===F&&0===E?(p=1,r=0):6===F&&0===E?(p=2,r=0):6===F&&3===E?(p=3,r=0):6===F&&6===E?(p=4,r=0):3===F&&6===E?(p=5,r=0):0===F&&6===E?(p=6,r=0):0===F&&3===E?(p=7,r=0):1===F&&1===E?(p=0,r=1):3===F&&1===E?(p=1,r=1):5===F&&1===E?(p=2,r=1):5===F&&3===E?(p=3,r=1):5===F&&5===E?(p=4,r=1):3===F&&5===E?(p=5,r=1):1===F&&5===E?(p=6,r=1):1===F&&3===E?(p=7,r=1):2===F&&2===E?(p=0,r=2):3===F&&2===E?(p=1,r=2):4===F&&2===E?(p=2,r=2):4===F&&3===E?(p=3,r=2):4===F&&4===E?(p=4,r=2):3===F&&4===E?(p=5,r=2):2===F&&4===E?(p=6,r=2):2===F&&3===E&&(p=7,r=2),"touchstart"===c&&!A){if(2===i||3===i){if(B={roww:E,col:F},A={row:r,col:p},C=document.getElementById("e2e_test_img_"+A.row+"x"+A.col),null!==C&&(C.style["z-index"]=++D),void 0===r||void 0===p)return void m();if(0>r||r>2||0>p||p>7)return void m();var s=0===a.turnIndex?"W":"B";if(a.board[r][p]!==s)return void m()}(4===i||1===i)&&d.$apply(function(){if(a.isYourTurn)try{var c=a.playerStates[a.turnIndex].phase;if(1===c)var d=h.createMove(a.board,a.playerStates,r,p,null,null,a.turnIndex);else if(4===c)var d=h.createMove(a.board,a.playerStates,null,null,r,p,a.turnIndex);f.makeMove(d)}catch(e){return void b.info(["Can't place piece:",r])}})}if(!C)return;if("touchend"===c){var t=A,u={row:r,col:p},i=a.playerStates[a.turnIndex].phase;(2===i||3===i)&&q(t,u)}else{console.log(x.clientWidth);var l=o();console.log("size.width: "+l.width/2+"size.height"+l.height/2+"x"+j+"y"+k),n({top:k-l.height/2,left:j-l.width/2})}}("touchend"===c||"touchcancel"===c||"touchleave"===c)&&m()}}function m(){var a=p(E,F);n(a),null!==C&&(C.removeAttribute("style"),C=null),A=null,C=null}function n(a){var b=p(B.roww,B.col);null!==C&&(C.style.left=a.left-b.left+.03*x.clientWidth+"px",C.style.top=a.top-b.top+.03*x.clientHeight+"px")}function o(){return{width:x.clientWidth/z,height:x.clientHeight/y}}function p(a,b){var c=o();return{top:a*c.height,left:b*c.width}}function q(c,e){d.$apply(function(){if(b.info(["Clicked on cell:",c.row,c.col]),"?throwException"===window.location.search)throw new Error("Throwing the error because URL has '?throwException'");if(a.isYourTurn){void 0===a.waitPiece&&(a.waitPiece=!1),void 0===a.lastPlacement&&(a.lastPlacement={});try{var d=a.playerStates[a.turnIndex].phase;if(2===d||3===d){var g=h.createMove(a.board,a.playerStates,e.row,e.col,c.row,c.col,a.turnIndex);f.makeMove(g),console.log(C)}}catch(i){return void b.info(["Can't move piece:",c.row,c.col])}}})}function r(){d.$apply(function(){b.info("Animation ended"),u=!0,v&&s()})}function s(){f.makeMove(i.createComputerMove(a.board,a.playerStates,a.turnIndex,{millisecondsLimit:1e3}))}function t(b){u=!1,w=b.stateAfterMove,a.board=b.stateAfterMove.board,a.delta=b.stateAfterMove.delta,a.playerStates=b.stateAfterMove.playerStates,void 0===a.board&&(a.board=h.getInitialBoard()),void 0===a.playerStates&&(a.playerStates=h.getInitialStates()),a.isYourTurn=b.turnIndexAfterMove>=0&&b.yourPlayerIndex===b.turnIndexAfterMove,a.turnIndex=b.turnIndexAfterMove,a.isYourTurn&&""===b.playersInfo[b.yourPlayerIndex].playerId&&(a.isYourTurn=!1,c(s,1e3))}j.setWidthToHeight(.866525424);var u=!1,v=!1,w=null,x=(document.getElementById("draggingLines"),document.getElementById("horizontalDraggingLine"),document.getElementById("verticalDraggingLine"),document.getElementById("gameArea")),y=7,z=7,A=null,B=null,C=null,D=61;k.addDragListener("gameArea",l);var E,F;document.addEventListener("animationend",r,!1),document.addEventListener("webkitAnimationEnd",r,!1),document.addEventListener("oanimationend",r,!1),window.e2e_test_stateService=g,a.shouldShowImage=function(b,c){var d=a.board[b][c];return""!==d},a.shouldHighLight=function(b,c){if(void 0===a.playerStates||-1===a.turnIndex)return!1;var d=0===a.turnIndex?"W":"B",e=a.turnIndex,f=a.board,g=a.playerStates[a.turnIndex].phase;if(1===g)return!1;if(2===g||3===g)return f[b][c]===d?!0:!1;if(4===g){var h=1===e?"W":"B";return f[b][c]===h?!0:!1}},a.getImageSrc=function(b,c){var d=a.board[b][c];return"W"===d?"imgs/white.png":"B"===d?"imgs/black.png":""},a.shouldEnLar=function(a,b){var c=!u&&void 0!==w.delta&&w.delta.destination[0]===a&&w.delta.destination[1]===b;return c},a.shouldFade=function(a,b){return!u&&void 0!==w.delta&&w.delta.origin[0]===a&&w.delta.origin[1]===b},f.setGame({gameDeveloperEmail:"zhuangzeleng19920731@gmail.com",minNumberOfPlayers:2,maxNumberOfPlayers:2,isMoveOk:h.isMoveOk,updateUI:t})}]),angular.module("myApp").factory("aiService",["alphaBetaService","gameLogic",function(a,b){function c(b,c,g,h){return a.alphaBetaDecision([null,{set:{key:"board",value:b}},{set:{key:"playerStates",value:c}}],g,f,e,"?debug"===window.location.search?d:null,h)}function d(a){return"\n"+a[1].set.value.join("\n")+"\n"}function e(a){if(a[0].endMatch){var b=a[0].endMatch.endMatchScores;return b[0]>b[1]?Number.POSITIVE_INFINITY:b[0]<b[1]?Number.NEGATIVE_INFINITY:0}return 4===a[2].set.value[0].phase?Number.POSITIVE_INFINITY/2:4===a[2].set.value[1].phase?Number.NEGATIVE_INFINITY/2:1e12*a[2].set.value[0].alreadyMills.length-1e12*a[2].set.value[1].alreadyMills.length}function f(a,c){return b.getAllPossibleMove(a[1].set.value,a[2].set.value,c)}return{createComputerMove:c}}]);
//# sourceMappingURL=everything.min.js.map